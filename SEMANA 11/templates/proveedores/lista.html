{% extends "base.html" %}

{% block title %}Catálogo de Proveedores{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="text-center">Catálogo de Proveedores</h2>
    <p class="lead text-center text-muted">Registro completo de PERNO TODO</p>

    <div class="mb-3 text-right">
        <a href="{{ url_for('agregar_proveedor') }}" class="btn btn-primary"><i class="fas fa-plus-circle"></i> Agregar Proveedor</a>
    </div>

    {% if proveedores %}
    <p class="text-muted">Mostrando **{{ proveedores | length }}** de **{{ total_proveedores }}** proveedores registrados.</p>
    
    <div class="table-responsive">
        <table class="table table-striped table-hover table-bordered shadow-sm">
            <thead class="thead-dark">
                <tr>
                    <th>RUC</th>
                    <th>Empresa</th>
                    <th>Contacto</th>
                    <th>Teléfono</th>
                    <th>Dirección</th>
                    <th>Email</th>
                    <th>F. Registro</th>
                    <th class="text-center">Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for proveedor in proveedores %}
                <tr>
                    <td>{{ proveedor.ruc }}</td>
                    <td>{{ proveedor.nombre_empresa }}</td>
                    <td>{{ proveedor.contacto }}</td>
                    <td>{{ proveedor.telefono }}</td>
                    <td>{{ proveedor.direccion }}</td>
                    <td>{{ proveedor.email }}</td>
                    <td>{{ proveedor.fecha_registro | default('') }}</td>
                    
                    <td class="text-center">
                        <a href="{{ url_for('editar_proveedor', id_proveedor=proveedor.id_proveedor) }}" class="btn btn-sm btn-warning" title="Editar"><i class="fas fa-edit"></i></a>
                        
                        <form method="POST" action="{{ url_for('eliminar_proveedor', id_proveedor=proveedor.id_proveedor) }}" 
                              style="display:inline;" onsubmit="return confirm('¿Está seguro de eliminar a {{ proveedor.nombre_empresa }}? Esta acción es irreversible.');">
                            <button type="submit" class="btn btn-sm btn-danger" title="Eliminar"><i class="fas fa-trash"></i></button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <nav aria-label="Paginación de proveedores">
        <ul class="pagination justify-content-center">
            <li class="page-item {% if page == 1 %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('listar_proveedores', page=page-1) }}" aria-disabled="true">Anterior</a>
            </li>
            {% for p in range(1, total_pages + 1) %}
                {% if p == page or p == 1 or p == total_pages or (p >= page - 2 and p <= page + 2) %}
                    <li class="page-item {% if p == page %}active{% endif %}">
                        <a class="page-link" href="{{ url_for('listar_proveedores', page=p) }}">{{ p }}</a>
                    </li>
                {% elif p == page - 3 or p == page + 3 %}
                    <li class="page-item disabled"><span class="page-link">...</span></li>
                {% endif %}
            {% endfor %}
            <li class="page-item {% if page == total_pages or total_pages == 0 %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('listar_proveedores', page=page+1) }}">Siguiente</a>
            </li>
        </ul>
    </nav>

    {% else %}
    <div class="alert alert-info text-center">
        No hay proveedores registrados.
    </div>
    {% endif %}
</div>
{% endblock %}